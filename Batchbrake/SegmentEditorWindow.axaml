<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="using:Batchbrake.ViewModels"
        x:Class="Batchbrake.SegmentEditorWindow"
        x:DataType="vm:SegmentEditorViewModel"
        Title="Edit Video Segments"
        Width="600" Height="500"
        MinWidth="500" MinHeight="400"
        WindowStartupLocation="CenterOwner">

  <Window.Styles>
    <Style Selector="Button">
      <Setter Property="Padding" Value="12,6"/>
      <Setter Property="MinWidth" Value="80"/>
    </Style>
    <Style Selector="Button.primary">
      <Setter Property="Background" Value="#0078D4"/>
      <Setter Property="Foreground" Value="White"/>
    </Style>
    <Style Selector="Button.primary:pointerover">
      <Setter Property="Background" Value="#106EBE"/>
    </Style>
    <Style Selector="Button.danger">
      <Setter Property="Background" Value="#D13438"/>
      <Setter Property="Foreground" Value="White"/>
    </Style>
    <Style Selector="Button.danger:pointerover">
      <Setter Property="Background" Value="#A4262C"/>
    </Style>
    <Style Selector="TextBlock.header">
      <Setter Property="FontSize" Value="16"/>
      <Setter Property="FontWeight" Value="SemiBold"/>
      <Setter Property="Margin" Value="0,0,0,10"/>
    </Style>
  </Window.Styles>

  <Grid Margin="20">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="*"/>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="Auto"/>
    </Grid.RowDefinitions>

    <!-- Header -->
    <TextBlock Grid.Row="0" Classes="header" Text="{Binding VideoFileName, StringFormat='Segments for: {0}'}"/>
    
    <!-- Video Duration Info -->
    <Border Grid.Row="1" Background="#F8F8F8" BorderBrush="#E0E0E0" BorderThickness="1" CornerRadius="4" Padding="10" Margin="0,0,0,15">
      <StackPanel Orientation="Horizontal" Spacing="20">
        <TextBlock Text="{Binding VideoDuration, StringFormat='Total Duration: {0:hh\\:mm\\:ss}'}" FontWeight="SemiBold"/>
        <TextBlock Text="{Binding SegmentCount, StringFormat='Segments: {0}'}" Foreground="#666666"/>
      </StackPanel>
    </Border>

    <!-- Segments List -->
    <Border Grid.Row="2" BorderBrush="#D0D0D0" BorderThickness="1" CornerRadius="4" Background="White">
      <Grid>
        <Grid.RowDefinitions>
          <RowDefinition Height="Auto"/>
          <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Column Headers -->
        <Border Grid.Row="0" Background="#F8F8F8" BorderBrush="#E0E0E0" BorderThickness="0,0,0,1">
          <Grid Margin="10,8">
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="40"/>
              <ColumnDefinition Width="120"/>
              <ColumnDefinition Width="120"/>
              <ColumnDefinition Width="120"/>
              <ColumnDefinition Width="*"/>
              <ColumnDefinition Width="80"/>
            </Grid.ColumnDefinitions>
            
            <TextBlock Grid.Column="0" Text="#" FontWeight="SemiBold" FontSize="12"/>
            <TextBlock Grid.Column="1" Text="Start Time" FontWeight="SemiBold" FontSize="12"/>
            <TextBlock Grid.Column="2" Text="End Time" FontWeight="SemiBold" FontSize="12"/>
            <TextBlock Grid.Column="3" Text="Duration" FontWeight="SemiBold" FontSize="12"/>
            <TextBlock Grid.Column="4" Text="Preview" FontWeight="SemiBold" FontSize="12"/>
            <TextBlock Grid.Column="5" Text="Actions" FontWeight="SemiBold" FontSize="12" HorizontalAlignment="Center"/>
          </Grid>
        </Border>

        <!-- Segments List -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
          <ItemsControl ItemsSource="{Binding Segments}">
            <ItemsControl.ItemTemplate>
              <DataTemplate>
                <Border BorderBrush="#E0E0E0" BorderThickness="0,0,0,1" Background="{Binding $parent.Background}">
                  <Grid Margin="10,8">
                    <Grid.ColumnDefinitions>
                      <ColumnDefinition Width="40"/>
                      <ColumnDefinition Width="120"/>
                      <ColumnDefinition Width="120"/>
                      <ColumnDefinition Width="120"/>
                      <ColumnDefinition Width="*"/>
                      <ColumnDefinition Width="80"/>
                    </Grid.ColumnDefinitions>

                    <!-- Index -->
                    <TextBlock Grid.Column="0" Text="{Binding Index}" VerticalAlignment="Center" FontWeight="SemiBold"/>

                    <!-- Start Time -->
                    <TextBox Grid.Column="1" Text="{Binding StartTimeText}" 
                           VerticalAlignment="Center" Margin="0,0,5,0"
                           Watermark="00:00:00" FontFamily="Consolas"/>

                    <!-- End Time -->
                    <TextBox Grid.Column="2" Text="{Binding EndTimeText}" 
                           VerticalAlignment="Center" Margin="0,0,5,0"
                           Watermark="00:00:00" FontFamily="Consolas"/>

                    <!-- Duration -->
                    <TextBlock Grid.Column="3" Text="{Binding Duration, StringFormat={}{0:hh\\:mm\\:ss}}" 
                             VerticalAlignment="Center" Foreground="#666666" Margin="0,0,5,0"/>

                    <!-- Preview -->
                    <TextBlock Grid.Column="4" Text="{Binding PreviewText}" 
                             VerticalAlignment="Center" Foreground="#666666" 
                             TextTrimming="CharacterEllipsis" Margin="0,0,5,0"/>

                    <!-- Actions -->
                    <StackPanel Grid.Column="5" Orientation="Horizontal" Spacing="3" 
                              HorizontalAlignment="Center">
                      <Button ToolTip.Tip="Remove segment"
                              Command="{Binding ((vm:SegmentEditorViewModel)DataContext).RemoveSegmentCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                              CommandParameter="{Binding}"
                              Classes="danger"
                              Padding="4" MinWidth="24" Width="24" Height="24">
                        <PathIcon Data="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" 
                                Width="12" Height="12"/>
                      </Button>
                    </StackPanel>
                  </Grid>
                </Border>
              </DataTemplate>
            </ItemsControl.ItemTemplate>
          </ItemsControl>
        </ScrollViewer>

        <!-- Empty State -->
        <StackPanel Grid.Row="1" HorizontalAlignment="Center" VerticalAlignment="Center" 
                   IsVisible="{Binding !HasSegments}">
          <PathIcon Data="M12,2C6.48,2 2,6.48 2,12C2,17.52 6.48,22 12,22C17.52,22 22,17.52 22,12C22,6.48 17.52,2 12,2M12,4C16.42,4 20,7.58 20,12C20,16.42 16.42,20 12,20C7.58,20 4,16.42 4,12C4,7.58 7.58,4 12,4M12,6A6,6 0 0,0 6,12A6,6 0 0,0 12,18A6,6 0 0,0 18,12A6,6 0 0,0 12,6M12,8A4,4 0 0,1 16,12A4,4 0 0,1 12,16A4,4 0 0,1 8,12A4,4 0 0,1 12,8Z" 
                  Width="48" Height="48" Foreground="#CCCCCC"/>
          <TextBlock Text="No segments defined" FontSize="14" Foreground="#666666" Margin="0,10,0,0"/>
          <TextBlock Text="The entire video will be converted" FontSize="12" Foreground="#999999" Margin="0,5,0,0"/>
        </StackPanel>
      </Grid>
    </Border>

    <!-- Add Segment Section -->
    <Border Grid.Row="3" Background="#F8F8F8" BorderBrush="#E0E0E0" BorderThickness="1" CornerRadius="4" Padding="15" Margin="0,15,0,0">
      <Grid>
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="Auto"/>
          <ColumnDefinition Width="*"/>
          <ColumnDefinition Width="Auto"/>
          <ColumnDefinition Width="*"/>
          <ColumnDefinition Width="Auto"/>
        </Grid.ColumnDefinitions>

        <TextBlock Grid.Column="0" Text="Add Segment:" VerticalAlignment="Center" FontWeight="SemiBold" Margin="0,0,15,0"/>
        
        <StackPanel Grid.Column="1" Spacing="5">
          <TextBlock Text="Start Time" FontSize="12" Foreground="#666666"/>
          <TextBox Text="{Binding NewSegmentStartTime}" 
                 Watermark="00:00:00" FontFamily="Consolas" Width="100"/>
        </StackPanel>

        <TextBlock Grid.Column="2" Text="to" VerticalAlignment="Center" Margin="15,15,15,0"/>

        <StackPanel Grid.Column="3" Spacing="5">
          <TextBlock Text="End Time" FontSize="12" Foreground="#666666"/>
          <TextBox Text="{Binding NewSegmentEndTime}" 
                 Watermark="00:00:00" FontFamily="Consolas" Width="100"/>
        </StackPanel>

        <Button Grid.Column="4" Classes="primary" 
              Command="{Binding AddSegmentCommand}"
              VerticalAlignment="Bottom" Margin="15,0,0,0">
          <StackPanel Orientation="Horizontal" Spacing="5">
            <PathIcon Data="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z" Width="14" Height="14"/>
            <TextBlock Text="Add"/>
          </StackPanel>
        </Button>
      </Grid>
    </Border>

    <!-- Dialog Buttons -->
    <StackPanel Grid.Row="4" Orientation="Horizontal" HorizontalAlignment="Right" Spacing="10" Margin="0,20,0,0">
      <Button Content="Clear All" Command="{Binding ClearAllCommand}" 
            IsEnabled="{Binding HasSegments}"/>
      <Button Content="Cancel" Command="{Binding CancelCommand}"/>
      <Button Content="OK" Classes="primary" Command="{Binding OkCommand}"/>
    </StackPanel>
  </Grid>
</Window>